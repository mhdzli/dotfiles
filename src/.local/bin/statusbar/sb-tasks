#!/bin/sh

# Originally by Andr3as07 <https://github.com/Andr3as07>
# Some changes by Luke

# This block displays the number running background tasks.  Requires tsp.

tspout="$(tsp -l)"

# Handle mouse clicks
case $BLOCK_BUTTON in
	1) echo "$tspout" > "${XDG_CACHE_HOME:-$HOME/.cache}/tspout"
		setsid -f "$TERMINAL" -e less "${XDG_CACHE_HOME:-$HOME/.cache}/tspout" ;;
	3) notify-send "Tasks module" "ðŸ¤–: number of running/queued background tasks
- Left click opens tsp" ;; # Right click
	2) $EDITOR "$0" ;; # Middle click
esac

numr=$(echo "$tspout" | grep -c "running")
numq=$(echo "$tspout" | grep -c "queued")

num=$((numr + numq))

[ "$num" -gt 0 ] &&
   echo "ðŸ¤–$num($numq)"
